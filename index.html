<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kasir</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
    <style>
        .dark-mode {
            background-color: #333;
            color: #fff;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div id="loginSection" class="container mt-4">
        <h2>Login</h2>
        <input type="text" id="username" class="form-control my-2" placeholder="Username">
        <input type="password" id="password" class="form-control my-2" placeholder="Password">
        <button class="btn btn-primary" onclick="login(document.getElementById('username').value, document.getElementById('password').value)">Login</button>
    </div>

    <div id="adminSection" class="container mt-4" style="display:none;">
        <h2>Admin Panel</h2>
        <button class="btn btn-secondary mb-3" onclick="toggleTheme()">Ganti Tema</button>
        <h3>Manajemen Produk</h3>
        <form id="productForm">
            <input type="text" id="productName" class="form-control my-2" placeholder="Nama Produk">
            <input type="number" id="productPrice" class="form-control my-2" placeholder="Harga">
            <input type="number" id="productStock" class="form-control my-2" placeholder="Stok">
            <select id="productCategory" class="form-select my-2">
                <option value="" disabled selected>Pilih Kategori</option>
                <option value="Elektronik">Elektronik</option>
                <option value="Makanan">Makanan</option>
            </select>
            <select id="productSupplier" class="form-select my-2">
                <option value="" disabled selected>Pilih Supplier</option>
                <option value="PT ABC">PT ABC</option>
                <option value="PT XYZ">PT XYZ</option>
            </select>
            <button type="button" class="btn btn-success" onclick="addProduct()">Tambah Produk</button>
        </form>
        <h3>Daftar Produk</h3>
        <div id="productList"></div>
    </div>

    <div id="kasirSection" class="container mt-4" style="display:none;">
        <h2>Kasir Panel</h2>
        <button class="btn btn-secondary mb-3" onclick="toggleTheme()">Ganti Tema</button>
        <h3>Transaksi</h3>
        <form>
            <select id="transactionProduct" class="form-select my-2">
                <option value="" disabled selected>Pilih Produk</option>
            </select>
            <input type="number" id="transactionQuantity" class="form-control my-2" placeholder="Jumlah">
            <select id="paymentMethod" class="form-select my-2">
                <option value="" disabled selected>Pilih Metode Pembayaran</option>
                <option value="cash">Cash</option>
                <option value="transfer">Transfer</option>
                <option value="qr">QR</option>
            </select>
            <button type="button" class="btn btn-primary" onclick="addTransaction()">Tambah Transaksi</button>
        </form>
        <h3>Daftar Transaksi</h3>
        <div id="transactionList"></div>
        <h4 id="totalRevenue">Total Pendapatan: Rp0.00</h4>
    </div>

    <div id="transactionHistory" class="container mt-4">
        <h2>Histori Transaksi</h2>
        <button class="btn btn-info" onclick="exportTransactionsToCSV()">Export Laporan</button>
        <div id="reportList"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jsbarcode"></script>
    <script>
        let currentUser = null;

        const dataStore = {
            products: [],
            transactions: [],
        };

        const users = [
            { username: 'admin', password: 'admin123', role: 'admin' },
            { username: 'kasir', password: 'kasir123', role: 'kasir' }
        ];

        function generateId(prefix) {
            return `${prefix}-${Math.random().toString(36).substr(2, 9)}`;
        }

        function login(username, password) {
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                alert(`Selamat datang, ${user.username}!`);
                configureUIForRole(user.role);
            } else {
                alert('Username atau password salah!');
            }
        }

        function configureUIForRole(role) {
            document.getElementById('loginSection').style.display = 'none';
            if (role === 'admin') {
                document.getElementById('adminSection').style.display = 'block';
                document.getElementById('kasirSection').style.display = 'none';
            } else if (role === 'kasir') {
                document.getElementById('adminSection').style.display = 'none';
                document.getElementById('kasirSection').style.display = 'block';
            }
        }

        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const category = document.getElementById('productCategory').value;
            const supplier = document.getElementById('productSupplier').value;

            if (!name || !price || !stock || !category || !supplier) {
                alert('Semua field wajib diisi!');
                return;
            }

            if (price <= 0 || stock < 0) {
                alert('Harga dan stok harus lebih besar dari 0!');
                return;
            }

            dataStore.products.push({ id: generateId('PROD'), name, price, stock, category, supplier });
            displayProducts();
        }

        function displayProducts() {
            document.getElementById('productList').innerHTML = dataStore.products.map(prod =>
                `<div>${prod.name} - Rp${prod.price} (Stok: ${prod.stock}, Kategori: ${prod.category}, Supplier: ${prod.supplier})</div>`).join('');
        }

        function addTransaction() {
            const productId = document.getElementById('transactionProduct').value;
            const quantity = parseInt(document.getElementById('transactionQuantity').value);
            const paymentMethod = document.getElementById('paymentMethod').value;

            const product = dataStore.products.find(p => p.id === productId);
            if (!product || product.stock < quantity) return alert('Produk tidak mencukupi!');

            const total = product.price * quantity;
            dataStore.transactions.push({ id: generateId('TRAN'), productId, quantity, total, paymentMethod, status: 'Belum Lunas' });
            product.stock -= quantity;
            displayTransactions();
        }

        function displayTransactions() {
            document.getElementById('transactionList').innerHTML = dataStore.transactions.map(tran =>
                `<div>${tran.id} - ${tran.productId} (Qty: ${tran.quantity}, Total: Rp${tran.total.toFixed(2)}, Status: ${tran.status})</div>`).join('');
        }

        function exportTransactionsToCSV() {
            const csvContent = dataStore.transactions.map(tran => `${tran.id},${tran.productId},${tran.quantity},${tran.total},${tran.paymentMethod},${tran.status}`).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'transactions.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }
    </script>
</body>
</html>
